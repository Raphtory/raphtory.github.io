---
layout: post
title:  "Finding Money cycles in NFTs"
categories:  [Features,Analysis]
author: 'Haaroon Yousaf'
excerpt: This post will walk through how we setup Raphtory and wrote a new algorithm 
to analyse data from NFTs. 
---

# What are NFTs? And Why NFTs?

A Non-fungible Token (NFT) is a digital asset, for example a digital version of the Mona Lisa artwork. These NFTs are stored on blockchain systems, one of which includes Ethereum. 

Anyone, including robots, can make, buy and sell NFTs. This is usually done with cryptocurrencies on marketplaces like OpenSea (this is an Ebay for NFTs) or directly between person to person. 

![Quantum NFT, image via Portion, provided by Sotheby's ](http://web.archive.org/web/20220328080727im_/https://blog.portion.io/content/images/2021/07/Kevin-McCoy-Quantum.gif)

Above is the first NFT, "Quantum", created by Kevin McCoy. Since, many variants have arisen including Cryptokitties and Cryptopunks. The market saw a boon in 2021 which included the arrival of the Bored Ape Yacht Club. In 2021 the global market for NFTs was valued at $15.7 Billion USD. 

This has naturally attracted forms of crime, whereby on 1st June 2022 a former employee of an NFT market place was charged first ever suit of digital asset insider trading. A crime report from chainalysis recently revealed that 262 users have been participating in wash-trading their NFTs.  

But, what one should ask the question, how about other forms of patterns? Have users cycled NFTs between each other? Have they done this repeatedly? Is this money cycle widespread? 

We use Raphtory to investigate and analyse this phenomena. 


## Overview of the data

We used open data from the "Mapping the NFT revolution: market trends, trade networks, and visual features" paper. 
This dataset contains 4.7 million NFTs that in total were traded across 6.1 million transactions between June 23, 2017 and April 27, 2021. 


The data is pre-classified and contains transactions details for NFTs sales including the buyers, sellers, type of NFT, price and time. 
The NFT sales are spread across various tokens and cryptocurrencies. 
However, in some cases the price data in USD was unavailable, so we therefore chose to restrict our data to those traded with Ethereum. 

This left us with 2.3 million trades across 3,384 NFTs. 

| Smart_contract                             |   ID_token | Transaction_hash                                                   | Seller_address                             | Seller_username   | Buyer_address                              | Buyer_username   |   Price_Crypto | Crypto   |   Price_USD | Collection       | Market   |Datetime_updated_seconds   | Collection_cleaned   | Category    |
|:----|------:|:---------------|:---------|:--------|:--------|:---------|----------:|:---------|--------:|:-----------|:---------|:--------|:----|:-------|
| 0xd73be.. |   66733 | 0xcdb2c..  | 0xd0c23..  | GorillaNixon      | 0xf6362..  | iMott   |  0.008 | ETH      |     15.4833 | Blockchaincuties | OpenSea  |  | 2021-04-01 00:05:09  | Block   | Collectible |

Above is a small capture of a single row of data, that we have simplified by removing excess columns. In some cases, we noticed the USD price was missing which we had to obtained using average price of the day of the trade. 

## Modelling the data 

Prior research has analysed this data as a full network graph, however we want to take a different approach. 
For this dataset, we created a bipartite graph, with nodes being addresses and NFTs, and edges being sales (when a wallet purchases an NFT). 

![Example of an NFT Bipartide Graph](_posts/buy_nft.png)

Above is an example of a bipartide graph. 
On the left we have Ethereum wallets, the right NFTs, and the edges are purchases. 
The first wallet purchased two NFTs, each at blocktime of 1. 
We can see that the second wallet, purchased the card NFT at block 2, for 2 ETH.
And finally, the 3rd wallet bought a cryptokitty at blocktime 4 for 1.1 ETH. 

Whats interesting here is that the card game NFT, was purchased by two users.
First by wallet 1, and then by wallet 2. This means that wallet 1 sold the card NFT for 2ETH, effectively making a profit of 0.8 ETH. 

Why do we model the data like this? Well Raphtory is a node centric analytics system. 
We go through nodes, extract their edge history, send messages between nodes and perform analytics. 
In this case, we can take each node that is an NFT, and go through each time someone bought this NFT. 

There are other ways we could model the data, for example nodes sending edges to other nodes when they purchased NFTs, but then we would have to keep the NFT data on the edge. Or, we could have wallets have an edge to an NFT, whom has another edge to the next buyer. But then this would be confusing and cause our graph to be more complicated. 

# Ingesting the data with a GraphBuilder

Now we understand our data and know how we are going to model it. 
We will turn this into a graph and create our own `GraphBuilder`. 

In Raphtory, GraphBuilders are responsible for turning data into network graphs. 

In our data, each row contains a transaction. This transaction states the buyer, seller, NFT, time and the financial cost. 

Raphtory is a distributed system and the GraphBuilder too is apart of this distributed model. 
It does not keep track of nodes and edges it has previously seen.
Therefore, for each row, we have to tell the GraphBuilder exactly what to add, as if it has not seen it before. 

For our case, we want to tell the GraphBuilder that for each row we will: 

* Buyer node -> send an `addVertex` message to saw we have seen a Buyer
* Seller node -> (since we arent drawing edges for sellers we can ignore the seller node)
* NFT -> send an `addVertex` message, to say we have seen an NFT
* Purchase transaction -> send an `addEdge` message to say we have seen a Buyer purchased an NFT

For each of these messages, we will also send properties, such as the time they happened,  the purchase price, the Ethereum Transaction hash etc.  

# Writing a Cycle detection algorithm

Now we have loaded our data into a graph, we can do some analysis using built-in Raphtory algorithms or write our own. Lets write a cycle detection algorithm. 

Our `cycle` is defined as follows:

    1. Alice owns an NFT(cat)
    2. Alice sells her NFT(cat) to someone else
    3. After some time, Alice repurchases her NFT(cat) at a higher price than she sold it.

Earlier, we designed our model to be a Bipartide graph, with `NFTs` and `Wallets`, where edges are `Transactions` that indicate a purchase. 

To find these cycles, we can 


   1. go through each `NFT` and get all of its edges
   2. Check the `buyer` of each transaction 
   3. Check to see if any user had bought the same NFT twice

For the code you can view the `CycleMania.scala` file on GitHub.

# Results

We begin with some simple stats. 

## Longest cycle (in terms of users that traded that NFT)

## Highest cost cycles (: NFTs that worth the most profit)

## # Traders that repurchased NFTs at a higher price, top 5 traders

## How many of a higher price cycles occured?

### over the whole of time

### On a half a day basis?

### On a day basis?

### On a Month basis?

### On a 3 month (quarterly basis)?

# NFT groups targeted with the most cycles? With the times above?

# Proofs of Pump and dumps

goes round the same nodes multiple times and then once its purchased by an outsider it stops being traded up

## On a point of this one, do the wallets after the dump start cycling another NFT?
 


Where Raphtory strives above all other analytical tools, is the ability to perform
temporal analysis within different time frames at scale. 


# Future works 

- Newer data sets 
- ??

# References

https://www.cryptokitties.co/

https://www.larvalabs.com/cryptopunks

https://boredapeyachtclub.com/ 

https://www.globenewswire.com/en/news-release/2022/05/26/2451426/0/en/The-Global-Non-Fungible-Tokens-NFTs-Market-is-expected-to-reach-a-value-of-USD-122-43-Billion-by-2028-at-a-CAGR-of-34-10-over-the-forecast-period-2022-2028-SkyQuest-Technology.html

https://www.justice.gov/usao-sdny/pr/former-employee-nft-marketplace-charged-first-ever-digital-asset-insider-trading-scheme


https://blog.chainalysis.com/reports/2022-crypto-crime-report-preview-nft-wash-trading-money-laundering/


Nadini, M., Alessandretti, L., Di Giacinto, F. et al. Mapping the NFT revolution: market trends, trade networks, and visual features. Sci Rep 11, 20902 (2021). https://doi.org/10.1038/s41598-021-00053-8